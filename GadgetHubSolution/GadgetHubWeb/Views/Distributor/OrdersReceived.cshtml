@model List<OrderDto>
@{
    ViewData["Title"] = "Orders Command Center - Gadget Hub";
    Layout = "_DistributorLayout";
}

<style>
    /* 🔧 ORDERS THEME */
    .orders-container {
        color: #e2e8f0 !important;
        font-family: 'Inter', sans-serif;
    }
    
    .page-header {
        background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
        border: 2px solid #3b82f6;
        border-radius: 20px;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        color: #e2e8f0 !important;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 30%, rgba(59, 130, 246, 0.05) 50%, transparent 70%);
        animation: shimmer 3s infinite;
    }
    
    .order-card {
        background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
        border: 2px solid #3b82f6;
        border-radius: 16px;
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
    }
    
    .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(59, 130, 246, 0.4);
        border-color: #10b981;
    }
    
    .order-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3b82f6 0%, #10b981 50%, #8b5cf6 100%);
        animation: borderGlow 2s infinite alternate;
    }
    
    .card-header {
        background: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
        color: #fff !important;
        border-bottom: 2px solid #e2e8f0;
        padding: 1rem 1.5rem;
        position: relative;
    }
    
    .card-header h5 {
        color: #fff !important;
        font-weight: 900;
        margin: 0;
    }
    
    .status-badge {
        background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
        color: #fff !important;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        border: 2px solid #e2e8f0;
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
    }
    
    .order-details {
        padding: 1.5rem;
        color: #e2e8f0 !important;
    }
    
    .detail-label {
        color: #10b981 !important;
        font-weight: 700;
        min-width: 140px;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .detail-value {
        color: #e2e8f0 !important;
        font-weight: 600;
    }
    
    .amount {
        color: #10b981 !important;
        font-size: 1.5rem;
        font-weight: 900;
        text-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
    }
    
    .btn-tech {
        background: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
        border: none;
        color: #fff !important;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-radius: 25px;
        padding: 0.75rem 1.5rem;
        transition: all 0.3s ease;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
    }
    
    .btn-tech:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.6);
        color: #fff !important;
    }
    
    .btn-tech-secondary {
        background: linear-gradient(135deg, #334155 0%, #475569 100%);
        border: 2px solid #3b82f6;
        color: #e2e8f0 !important;
    }
    
    .btn-tech-secondary:hover {
        background: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
        color: #fff !important;
    }
    
    .no-orders {
        text-align: center;
        padding: 4rem 2rem;
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        border: 2px solid #3b82f6;
        border-radius: 20px;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
    }
    
    .icon-large {
        font-size: 4rem;
        color: #3b82f6;
        margin-bottom: 1.5rem;
        animation: pulse 2s infinite;
    }
    
    .text-bright {
        color: #10b981 !important;
        font-weight: 700;
        text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
    }
    
    .text-accent {
        color: #3b82f6 !important;
        font-weight: 600;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-item {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        border: 2px solid #3b82f6;
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        transition: all 0.3s ease;
    }
    
    .stat-item:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 900;
        color: #10b981 !important;
        text-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
    }
    
    .stat-label {
        color: #e2e8f0 !important;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.8rem;
    }
    
    @@keyframes borderGlow {
        0% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    @@keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    @@keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .form-control {
        background: linear-gradient(135deg, #334155 0%, #475569 100%);
        border: 2px solid #3b82f6;
        color: #e2e8f0;
        font-weight: 600;
    }

    .form-control:focus {
        border-color: #10b981;
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
    }
</style>

<div class="orders-container">
    <!-- 🔧 Page Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="mb-3 text-bright" style="font-size: 2.5rem; font-weight: 900;">
                    <i class="fas fa-shopping-cart me-3" style="color: #3b82f6;"></i>ORDERS COMMAND CENTER
                </h1>
                <p class="text-white mb-0 fs-5">
                    Manage and process incoming product orders efficiently
                </p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="stats-summary">
                    <div class="text-accent">
                        <i class="fas fa-chart-line me-2"></i>CURRENT STATUS
                    </div>
                    <div class="text-bright">
                        @Model.Count ACTIVE ORDERS
                    </div>
                    <div class="text-white">
                        Total Value: $@Model.Sum(o => o.TotalAmount).ToString("N2")
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Any())
    {
        <!-- 🔧 Stats Grid -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">@Model.Count</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">@Model.Count(o => o.Status == "Processing")</div>
                <div class="stat-label">Processing</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">@Model.Count(o => o.Status == "Confirmed")</div>
                <div class="stat-label">Confirmed</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">$@Model.Sum(o => o.TotalAmount).ToString("N0")</div>
                <div class="stat-label">Total Value</div>
            </div>
        </div>

        <!-- 🔧 Orders List -->
        @foreach (var order in Model.OrderByDescending(o => o.OrderDate))
        {
            <div class="order-card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h5>
                                <i class="fas fa-receipt me-2"></i>ORDER #@order.Id
                                <span class="status-badge ms-2">@order.Status</span>
                            </h5>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="amount">$@order.TotalAmount.ToString("N2")</div>
                        </div>
                    </div>
                </div>

                <div class="order-details">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="order-info-grid">
                                <div class="detail-item mb-2">
                                    <span class="detail-label">Customer:</span>
                                    <span class="detail-value text-bright">@(order.CustomerName ?? "Customer")</span>
                                </div>
                                <div class="detail-item mb-2">
                                    <span class="detail-label">Order Date:</span>
                                    <span class="detail-value">@order.OrderDate.ToString("MMMM dd, yyyy HH:mm")</span>
                                </div>
                                <div class="detail-item mb-2">
                                    <span class="detail-label">Items:</span>
                                    <span class="detail-value">@order.ItemCount unique items (@order.TotalItems total)</span>
                                </div>
                                @if (order.EstimatedDeliveryDate.HasValue)
                                {
                                    <div class="detail-item mb-2">
                                        <span class="detail-label">Delivery:</span>
                                        <span class="detail-value">@order.EstimatedDeliveryDate.Value.ToString("MMMM dd, yyyy")</span>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(order.Notes))
                                {
                                    <div class="detail-item mb-2">
                                        <span class="detail-label">Notes:</span>
                                        <span class="detail-value">@order.Notes</span>
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="action-panel">
                                <h6 class="text-bright mb-3">⚡ CONTROLS</h6>
                                
                                <!-- Status Update -->
                                <div class="status-control mb-3">
                                    <select class="form-select form-control" id="status_@order.Id" 
                                            onchange="updateOrderStatus(@order.Id)">
                                        <option value="Confirmed" selected="@(order.Status == "Confirmed")">✅ Confirmed</option>
                                        <option value="Processing" selected="@(order.Status == "Processing")">⚙️ Processing</option>
                                        <option value="Shipped" selected="@(order.Status == "Shipped")">🚀 Shipped</option>
                                        <option value="Delivered" selected="@(order.Status == "Delivered")">🎯 Delivered</option>
                                        <option value="Cancelled" selected="@(order.Status == "Cancelled")">❌ Cancelled</option>
                                    </select>
                                </div>

                                <!-- Priority Indicator -->
                                <div class="priority-display mb-3">
                                    @{
                                        var priority = order.TotalAmount > 2000 ? "CRITICAL" : order.TotalAmount > 1000 ? "HIGH" : order.TotalAmount > 500 ? "MEDIUM" : "STANDARD";
                                        var priorityIcon = priority == "CRITICAL" ? "fa-fire" : priority == "HIGH" ? "fa-bolt" : priority == "MEDIUM" ? "fa-star" : "fa-check";
                                        var priorityColor = priority == "CRITICAL" ? "#ef4444" : priority == "HIGH" ? "#f97316" : priority == "MEDIUM" ? "#eab308" : "#10b981";
                                    }
                                    <div class="priority-badge" style="background: linear-gradient(135deg, @priorityColor 0%, rgba(255,255,255,0.2) 100%); 
                                                                             color: #fff; 
                                                                             padding: 0.5rem 1rem; 
                                                                             border-radius: 20px; 
                                                                             font-weight: 700; 
                                                                             text-align: center;">
                                        <i class="fas @priorityIcon me-2"></i>@priority PRIORITY
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="action-buttons d-grid gap-2">
                                    <button onclick="viewOrderItems(@order.Id)" class="btn-tech">
                                        <i class="fas fa-list me-2"></i>VIEW ITEMS
                                    </button>
                                    <button onclick="printOrderSlip(@order.Id)" class="btn-tech-secondary">
                                        <i class="fas fa-print me-2"></i>PRINT SLIP
                                    </button>
                                    @if (order.Status != "Delivered" && order.Status != "Cancelled")
                                    {
                                        <button onclick="markAsShipped(@order.Id)" class="btn-tech-secondary">
                                            <i class="fas fa-shipping-fast me-2"></i>SHIP ORDER
                                        </button>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <!-- 🔧 No Orders State -->
        <div class="no-orders">
            <i class="fas fa-inbox icon-large"></i>
            <h3 class="text-bright mb-3">NO ORDERS DETECTED</h3>
            <p class="text-white mb-4">
                Your command center is ready and waiting for incoming product orders.<br>
                Orders from customers who accept your quotations will appear here.
            </p>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">0</div>
                    <div class="stat-label">Active Orders</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">0</div>
                    <div class="stat-label">Processing</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">$0</div>
                    <div class="stat-label">Revenue</div>
                </div>
            </div>
            
            <div class="mt-4">
                <a href="@Url.Action("QuotationRequests", "Distributor")" class="btn-tech me-3">
                    <i class="fas fa-file-invoice-dollar me-2"></i>CHECK QUOTATIONS
                </a>
                <a href="@Url.Action("Index", "Distributor")" class="btn-tech-secondary">
                    <i class="fas fa-tachometer-alt me-2"></i>DASHBOARD
                </a>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // 🔧 Orders Management Scripts
        
        function updateOrderStatus(orderId) {
            const statusSelect = document.getElementById(`status_${orderId}`);
            const newStatus = statusSelect.value;
            
            console.log(`🔧 Updating order ${orderId} status to: ${newStatus}`);
            
            // Show loading state
            statusSelect.disabled = true;
            
            // Simulate API call
            fetch('@Url.Action("UpdateOrderStatus", "Distributor")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `orderId=${orderId}&status=${newStatus}&__RequestVerificationToken=${$('[name=__RequestVerificationToken]').val()}`
            })
            .then(response => {
                if (response.ok) {
                    // Show success notification
                    showTechNotification(`✅ Order #${orderId} status updated to ${newStatus}!`, 'success');
                    
                    // Update the UI
                    const statusBadge = statusSelect.closest('.order-card').querySelector('.status-badge');
                    if (statusBadge) {
                        statusBadge.textContent = newStatus;
                    }
                } else {
                    throw new Error('Failed to update order status');
                }
            })
            .catch(error => {
                console.error('🔧 Error:', error);
                showTechNotification(`❌ Error updating order status. Please try again.`, 'error');
                
                // Reset the select to previous value
                location.reload();
            })
            .finally(() => {
                statusSelect.disabled = false;
            });
        }
        
        function viewOrderItems(orderId) {
            console.log(`🔧 Viewing items for order ${orderId}`);
            window.location.href = `@Url.Action("ViewOrderItems", "Distributor")?orderId=${orderId}`;
        }
        
        function printOrderSlip(orderId) {
            console.log(`🔧 Printing order slip for order ${orderId}`);
            showTechNotification(`🖨️ Generating order slip for Order #${orderId}...`, 'info');
            
            // Simulate print generation
            setTimeout(() => {
                showTechNotification(`✅ Order slip generated for Order #${orderId}!`, 'success');
            }, 1500);
        }
        
        function markAsShipped(orderId) {
            if (confirm('🚀 Are you sure you want to mark this order as shipped?')) {
                console.log(`🔧 Marking order ${orderId} as shipped`);
                
                const statusSelect = document.getElementById(`status_${orderId}`);
                statusSelect.value = 'Shipped';
                updateOrderStatus(orderId);
            }
        }
        
        function showTechNotification(message, type) {
            // Create tech-style notification
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} tech-notification`;
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                background: linear-gradient(135deg, ${type === 'success' ? '#064e3b' : type === 'error' ? '#7f1d1d' : '#1e3a8a'} 0%, ${type === 'success' ? '#065f46' : type === 'error' ? '#991b1b' : '#1e40af'} 100%);
                border: 2px solid ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                border-radius: 12px;
                box-shadow: 0 0 20px rgba(${type === 'success' ? '16, 185, 129' : type === 'error' ? '239, 68, 68' : '59, 130, 246'}, 0.3);
                font-weight: 600;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" style="filter: invert(1);" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 4000);
        }
        
        // CSS for notification animation
        const style = document.createElement('style');
        style.textContent = `
            @@keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Console welcome message
        console.log(`
🔧 GADGET HUB ORDERS COMMAND CENTER
==================================
Orders Loaded: @Model.Count
Total Value: $@Model.Sum(o => o.TotalAmount).ToString("N2")
Status: OPERATIONAL
==================================
Ready to process orders! 🚀
        `);
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Orders page loaded successfully');
            
            // Add hover effects to order cards
            document.querySelectorAll('.order-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    console.log('🔧 Order card hover activated');
                });
            });
        });
    </script>
}